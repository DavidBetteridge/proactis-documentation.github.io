<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        <meta name="author" content="David Betteridge">
        
        <link rel="shortcut icon" href="../../img/favicon.ico">
        <title>Custom Tabs - Technical Documentation</title>
        <link href="../../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../../css/font-awesome-4.5.0.css" rel="stylesheet">
        <link href="../../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="../../css/highlight.css">
        <link href="../../css/extra.css" rel="stylesheet">
        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
	
	<script src="../../js/jquery-1.10.2.min.js"></script>
        <script src="../../js/bootstrap-3.0.3.min.js"></script>
        <script src="../../js/highlight.pack.js"></script> 
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="../..">Technical Documentation</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
                <!-- Main navigation -->
                <ul class="nav navbar-nav">
                    <li >
                        <a href="../..">PROACTIS</a>
                    </li>
                    <li class="dropdown active">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">P2P <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            
<li >
    <a href="../sso/">Single Sign On (SSO)</a>
</li>
                            
<li >
    <a href="../punchout/">PunchOut / Marketplaces</a>
</li>
                            
<li >
    <a href="../nominalvalidation/">Nominal Validation</a>
</li>
                            
<li >
    <a href="../budgetchecking/">Budget Checking</a>
</li>
                            
<li class="active">
    <a href="./">Custom Tabs</a>
</li>
                            
<li >
    <a href="../addins/">Addins</a>
</li>
                        </ul>
                    </li>
                    <li >
                        <a href="../../placeholder/">Spend Analytics</a>
                    </li>
                    <li >
                        <a href="../../placeholder/">APF</a>
                    </li>
                    <li >
                        <a href="../../placeholder/">S2C</a>
                    </li>
                    <li >
                        <a href="../../placeholder/">DueNorth</a>
                    </li>
                    <li >
                        <a href="../../placeholder/">System4</a>
                    </li>
                </ul>

            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                        <i class="fa fa-search"></i> Search
                    </a>
                </li>
                    <li >
                        <a rel="next" href="../budgetchecking/">
                            <i class="fa fa-arrow-left"></i> Previous
                        </a>
                    </li>
                    <li >
                        <a rel="prev" href="../addins/">
                            Next <i class="fa fa-arrow-right"></i>
                        </a>
                    </li>
                    <li>
                        <a href="https://github.com/proactis-documentation/ExampleApplications">CodeExamples
                        </a>
                    </li>
            </ul>
        </div>
    </div>
</div>

        <div class="container">
                <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
        <li class="main active"><a href="#custom-tab">Custom Tab</a></li>
        <li class="main "><a href="#licence-file">Licence File</a></li>
        <li class="main "><a href="#development">Development</a></li>
        <li class="main "><a href="#session-details">Session Details</a></li>
        <li class="main "><a href="#please-wait-spinner">Please Wait Spinner</a></li>
        <li class="main "><a href="#user-role-security">User Role Security</a></li>
        <li class="main "><a href="#example-application">Example Application</a></li>
        <li class="main "><a href="#troubleshooting">Troubleshooting</a></li>
    </ul>
</div></div>
                <div class="col-md-9" role="main">

<h1 id="custom-tab">Custom Tab</h1>
<p>The P2P website can be extended by creating additional "custom" tabs.  </p>
<hr />
<h1 id="licence-file">Licence File</h1>
<p>In order to display a custom tab you will first need a licence file which includes the name of the tab.  </p>
<p><img alt="alt text" src="../../img/p2p/customtab/licencefile.bmp" title="Licence File" /></p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Please contact your account manager for assistance with this.</p>
</div>
<p>In this example the tab will be displayed as  <strong>Manage Resource Bookings</strong> and will only be visible to users with the <strong>MAY_BOOK_RESOURCES</strong> user role.</p>
<p><img alt="alt text" src="../../img/p2p/customtab/newtab.JPG" title="New Tab" /> </p>
<hr />
<h1 id="development">Development</h1>
<p>Custom tab are developed as independent websites which are then displayed as part of the core site within an iFrame.</p>
<p><img alt="alt text" src="../../img/p2p/customtab/iframe.JPG" title="iFrame" /></p>
<p>In the screenshot above,  the blue menu bar comes from the main site,  whilst the remainder of the page (in white) is the custom tab.</p>
<p>By convention the custom sites are placed within the <strong>WebSite\Customer</strong> folder and are mapped as a virtual application with in IIS.   </p>
<p><img alt="alt text" src="../../img/p2p/customtab/iis.JPG" title="iis" /></p>
<p>In order for P2P to know the URL of the page is displayed it's path needs to be added to the <strong>ApplicationConfig.xml</strong> file.</p>
<p><img alt="alt text" src="../../img/p2p/customtab/config.JPG" title="config" /> </p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>After changing the application configuration file the caches in the website will need refreshing.   This can be done either by recycling the application pool,  or by performing an IIS reset.</p>
</div>
<hr />
<h1 id="session-details">Session Details</h1>
<p>As the custom tab is running in a different website to the main site it is not possible to share the session state within IIS.</p>
<p>Instead the following steps must be followed in order to obtain the details of the current user.</p>
<ul>
<li>
<p>Before the main site opens your landing page it first generates a unique session token which is stored in the database within the <strong>dsdba.LoginTokens</strong> table.  This table also holds who the current user is. </p>
</li>
<li>
<p>When the landing page is opened,  it is passed the following information as query string parameters</p>
<ul>
<li>Token  (the unique token)</li>
<li>Title  (the name of the tab)</li>
<li>URL    (the url of the tab)</li>
</ul>
<p>The token argument is made up of the {Database's Title} @ {The unique generated session token}</p>
</li>
<li>
<p>The custom tab should then connect to the P2P database and call the <strong>DSDBA.usp_cust_GetSessionDetailsFromToken</strong> stored procedure supplying the full token.  This stored procedure will return with a single row containing the following columns:</p>
<ul>
<li>UserGUID</li>
<li>LoginID</li>
<li>CompanyGUID</li>
<li>CompanyCode</li>
<li>DepartmentGUID</li>
<li>DepartmentCode</li>
<li>StoreGUID</li>
<li>StoreCode</li>
<li>SessionID  (the internal P2P session ID)</li>
<li>Expires  (when the login token will expiry)</li>
</ul>
</li>
</ul>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The stored procedure will return a row even when the session ID is not valid.  In this case however all the values will be NULL.</p>
</div>
<hr />
<h1 id="please-wait-spinner">Please Wait Spinner</h1>
<p>Whilst your tab is first loading the main site will be displaying the please wait spinner.  In order to remove the spinner the following javascript code should be added to the end of your first page</p>
<pre><code class="javascript">    &lt;script type=&quot;text/javascript&quot;&gt;
        //Hide the spinner in the main window.
        $().ready(function () {
            parent.hideSpinner();
        });
    &lt;/script&gt;
</code></pre>

<p>If you wish to re-display the spinner then the following javascript can be used</p>
<pre><code class="javascript">    &lt;script type=&quot;text/javascript&quot;&gt;
        window.parent.showSpinner();
    &lt;/script&gt;
</code></pre>

<hr />
<h1 id="user-role-security">User Role Security</h1>
<p>By default all users have access to the new tab.  If you wish to restrict access to only certain users then the name of a user role (or a custom role) can be specified for the tab within the licence file.</p>
<p>If you wish to create a custom role,  then you will also need to insert an entry into the <strong>DSDBA.Roles</strong> table with the same name.</p>
<pre><code class="sql">INSERT INTO DSDBA.Roles (GUID, Code, Description, Properties, CompanyGUID)
SELECT newID(), 'MAY_BOOK_RESOURCES', 'Users may use the bookings tab', '', C.GUID
  FROM DSDBA.Companies C
</code></pre>

<hr />
<h1 id="example-application">Example Application</h1>
<p>Please see the <a href="https://github.com/proactis-documentation/ExampleApplications/tree/master/P2P/Custom%20Tab">example application</a> for a complete implementation.</p>
<hr />
<h1 id="troubleshooting">Troubleshooting</h1>
<p>If your custom tab does not appear then check the following</p>
<ol>
<li>Your licence file includes the section for your custom tab.</li>
<li>If the RelatedRole has been specified in the licence file then the user has been granted that role.</li>
<li>The URL of the custom page has been specified in the <strong>web.config</strong> file</li>
</ol></div>
        </div>

        <footer class="col-md-12">
            <hr>
                <p>(C) PROACTIS Group Ltd - All Rights Reserved</p>
            <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>var base_url = '../..';</script>
        <script data-main="../../mkdocs/js/search.js" src="../../mkdocs/js/require.js"></script>
        <script src="../../js/base.js"></script><div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="exampleModalLabel">Search</h4>
            </div>
            <div class="modal-body">
                <p>
                    From here you can search these documents. Enter
                    your search terms below.
                </p>
                <form role="form">
                    <div class="form-group">
                        <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
